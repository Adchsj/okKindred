{% extends "base.html" %}
{% load staticfiles %}
{% load i18n %}

{% block extrastyle %}
    <link rel="stylesheet" type="text/css" href="{% static "css/lightbox.css" %}" />
{% endblock %}

{% block content %}

<div class="container" style="padding-top: 20px;">
    <p>
        <a class="btn btn-info" href="/gallery/" role="button">&laquo;{%trans "Back" %}</a>
        <a class="btn btn-success" href="/gallery={{ gallery.id }}/upload_images/" role="button">+{%trans "Add New Image" %}</a>
    </p>
    <h2>{{ gallery.title }}</h2>
    <p>
        {{ gallery.description }}
    </p>
    <div id="image_container">
       <div id="loadmoreajaxloader" style="display:none;">
           <center>
               <img src="{% static "img/ajax-loader.gif" %}" /> {% trans "Loading..." %}
           </center>
       </div>
    </div>

</div>

{% endblock %}

{% block extrascript %}
<script src="{% static "js/imagesloaded.pkgd.min.js" %}"></script>
<script src="{% static "js/masonry.pkgd.min.js" %}"></script>
<script src="{% static "js/lightbox.min.js" %}"></script>

<script type="text/javascript">
var page = 0;

//Request the galleries on page load
$( document ).ready(function() {
    load_more();
});


//Request more galleries when we scroll to the bottom
$(window).scroll(function()
{
    if($(window).scrollTop() == $(document).height() - $(window).height())
    {
        load_more();
    }
});

//Ajax request to get more galleries
function load_more()
{
    page = page + 1;
    $('div#loadmoreajaxloader').show();
    $.ajax({
        url: "/gallery={{ gallery.id }}/image_data=" + page.toString(),
        success: function(data)
        {
            if(data && data != '[]')
            {
                var html =[];
                for (var i in data)
                {
                    html.push('<a class="image_in_gallery" href="/media/');
                    html.push(data[i].fields.large_thumbnail);
                    html.push('" data-lightbox="');
                    html.push(data[i].fields.large_thumbnail);
                    html.push('" data-title="');
                    html.push(data[i].fields.title);

                    html.push(' | &lt;a href=\'/tags=');
                    html.push(data[i].pk);
                    html.push('\'&gt; {% trans "Tags" %} &lt;/a&gt');

                    html.push(' | &lt;a href=\'/media/');
                    html.push(data[i].fields.original_image);
                    html.push('\'&gt; {% trans "Download Original" %} &lt;/a&gt');

                    html.push('">');

                    html.push('<img class="masonry_thumbnail" src="/media/' + data[i].fields.thumbnail + '" ');
                    html.push('alt="' + data[i].fields.title +'/"')
                    html.push('/>');

                    html.push('</a>');
                }

                $("#image_container").append(html.join(''));
                $('div#loadmoreajaxloader').hide();


                var $container = $('#image_container');
                // initialize after all the images have loaded

                $container.imagesLoaded( function() {
                    $container.masonry({
                        itemSelector: '.image_in_gallery',
                        columnWidth: 1,
                        isFitWidth: true

                    });
                });


            }else
            {
                $('div#loadmoreajaxloader').html('<center>{% trans "No more images to show" %}.</center>');
            }
        }
    });
}

</script>

{% endblock %}