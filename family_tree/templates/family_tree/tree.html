{% extends "base.html" %}
{% load staticfiles %}
{% load i18n %}

{% block extrastyle %}

<style type="text/css">

    {{ css_normal }}

    /* Smartphones (portrait and landscape) --  --  --  --  -- - */
    @media only screen
    and (min-device-width : 320px)
    and (max-device-width : 479px) {
        {{ css_320 }}
    }

    @media only screen
    and (min-device-width : 480px)
    and (max-device-width : 767px) {
    /* Styles */
        {{ css_480 }}
    }

    /* iPads (portrait and landscape) --  --  --  --  -- - */
    @media only screen
    and (min-device-width : 768px)
    and (max-device-width : 991px) {
        {{ css_768 }}
    }

    /* Desktops and laptops --  --  --  --  -- - */
    @media only screen
    and (min-width:992px)
    and (max-device-width : 1199px) {
        {{ css_992 }}
    }


    @media only screen
    and (min-device-width : 1200px) {
        {{ css_1200 }}
    }




</style>
{% endblock %}

{% block content %}
<div class="container" style="padding-top: 20px;">
    <div class="family_tree_container" id="family_tree_container" style="position: relative;"> <!--I don't understand why this needs to inline! -->

        {% for relative in people %}
            <div id="person{{relative.id}}" class="w">
                <a href="/person={{relative.id}}/">
                    {% if relative.small_thumbnail %}
                        <img class="tree_thumb" alt="{{ relative.name }}" src="/media/{{relative.small_thumbnail}}"/>
                    {% else %}
                        <img class="tree_thumb" alt="{% trans "No photo uploaded for " %} {{ relative.name }}" src="{% static "img/portrait_80.png" %}"/>
                    {% endif %}
                    <div>
                        {{ relative.name }}
                    </div>
                </a>
            </div>
        {% endfor %}



        <div id ="person{{person.id}}" class="w" style="width: auto;">
            {% if person.small_thumbnail %}
                <img class="tree_thumb" src="/media/{{person.small_thumbnail}}"/>
            {% else %}
                <img class="tree_thumb" src="{% static "img/portrait_80.png" %}"/>
            {% endif %}
            <div>
                {{ person.name }}
            </div>

            <div><a class="btn btn-info" href="/profile={{ person.id }}/" role="button">{%trans "Profile" %}</a></div>
            <div><a class="btn btn-primary" href="/add_relation={{ person.id }}/" role="button">{%trans "Add Relation" %}</a></div>

        </div>


    </div>
</div>
{% endblock %}


{% block extrascript %}

    <script src="{% static "js/family_tree/dom.jsPlumb-1.7.5-min.js" %}"></script>
    <script>
    jsPlumb.ready(function() {

        // your jsPlumb related init code goes here

    	// setup some defaults for jsPlumb.
    	var instance = jsPlumb.getInstance({
    		Endpoint : ["Dot", {radius:2}],
    		HoverPaintStyle : {strokeStyle:"#1e8151", lineWidth:2 },
    		Container:"family_tree_container"
    	});


        window.jsp = instance;

    	var windows = jsPlumb.getSelector(".family_tree_container .w");

        instance.batch(function () {

            instance.makeSource(windows, {
                filter: ".ep",
                anchor: "Continuous",
                connector: [ "StateMachine", { curviness: 20 } ],
                connectorStyle: { strokeStyle: "#5c96bc", lineWidth: 2, outlineColor: "transparent", outlineWidth: 4 },
                maxConnections: 5,
                onMaxConnections: function (info, e) {
                    alert("Maximum connections (" + info.maxConnections + ") reached");
                }
            });

            // initialise all '.w' elements as connection targets.
            instance.makeTarget(windows, {
                dropOptions: { hoverClass: "dragHover" },
                anchor: "Continuous",
                allowLoopback: true
            });

            {% for relation in relations %}
                instance.connect({
                    source:"person{{ relation.from_person_id }}",
                    target:"person{{ relation.to_person_id }}",

                    overlays:[
                        [ "Arrow", { location:1, direction: 1, id:"arrow{{ relation.id }}"} ],
                        {% if relation.relation_type == 1 %}
                            [ "Arrow", { location:0, direction: -1, id:"inverse_arrow{{ relation.id }}"} ],
                            [ "Label", { label:"{% trans "partnered" %}", id:"label{{ relation.id }}", cssClass:"aLabel"} ]
                        {% else %}
                            [ "Label", { label:"{% trans "raised" %}", id:"label{{ relation.id }}", cssClass:"aLabel"} ]
                        {% endif %}
                        ]

                });
            {% endfor %}

            jsPlumb.fire("jsPlumbDemoLoaded", instance);
        });
    });
    </script>

{% endblock %}