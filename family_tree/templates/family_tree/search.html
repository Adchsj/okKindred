{% extends "base.html" %}
{% load i18n %}

{% block content %}

<div class="container">

    <form id="search_form" role="form" action="/get_search_results/" method="post">
        {% csrf_token %}
        <div class="form-group">
            <h2>{% trans "Search Name:" %}</h2>
            <div class="form-group">
                <input type="search_text" id="search_text" name="search_text" class="form-control" placeholder="Name" required autofocus>
            </div>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-striped">
              <tbody id="results">
              </tbody>
        </table>
    </div>

</div>

{% endblock %}

{% block extrascript %}
<script>
    $(document).ready(function(){

        //input event only works on IE > 9
        $("#search_form").bind('input', function() {

            if($('#search_text').val()==null || $('#search_text').val()=="")
            {
                $('#results').html("");
                return false;
            }

            $('#results').html('{% trans "Loading..." %}');

            var $form = $(this);

            // Serialize the data in the form
            var serializedData = $form.serialize();


                // Fire off the request to /form.php
            request = $.ajax({
                url: "/get_search_results_json/",
                dataType: "json",
                type: "post",
                data: serializedData
            });

            // Callback handler that will be called on success
            request.done(function (data){

                //Clear results
                $('#results').html('');

                for (var i in data){
                    //Build an array using the data
                    var row = ['<tr>']
                    row.push('<td class="search_photo"><a href="/profile=' + data[i].pk + '">');

                    if (data[i].fields.small_thumbnail == '' || data[i].fields.small_thumbnail == null){
                        row.push('<img src="/static/img/smiley_80.jpg"/>');
                    }
                    else{
                        row.push('<img src="/media/' + data[i].fields.small_thumbnail + '"/>');
                    }

                    row.push('</a></td>');
                    row.push('<td style="padding-top:40px"><a href="/profile=' + data[i].pk + '">' + data[i].fields.name);
                    row.push('</a></td>');
                    row.push('</td></tr>');

                    //Append it to the table
                    $('#results').append(row.join(''));
                }

            });

        });

    });
</script>
{% endblock %}